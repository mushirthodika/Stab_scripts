format short

s = dlmread('stab-points.dat');
a=s(:,1);
E=s(:,2);

syms p1 p2 p3 q0 q1 q2 q3 r0 r1 r2 r3

eqn1 = (E(1)^2)*a(1)*p1 + (E(1)^2*a(1)^2)*p2 + (E(1)^2*a(1)^3)*p3 + E(1)*q0 + E(1)*a(1)*q1 + E(1)*(a(1)^2)*q2 + E(1)*(a(1)^3)*q3 + r0 + a(1)*r1 + (a(1)^2)*r2 + (a(1)^3)*r3 == -(E(1)^2);
eqn2 = (E(2)^2)*a(2)*p1 + (E(2)^2*a(2)^2)*p2 + (E(2)^2*a(2)^3)*p3 + E(2)*q0 + E(2)*a(1)*q1 + E(2)*(a(2)^2)*q2 + E(2)*(a(2)^3)*q3 + r0 + a(2)*r1 + (a(2)^2)*r2 + (a(2)^3)*r3 == -(E(2)^2);
eqn3 = (E(3)^2)*a(3)*p1 + (E(3)^2*a(3)^2)*p2 + (E(3)^2*a(3)^3)*p3 + E(3)*q0 + E(3)*a(3)*q1 + E(3)*(a(3)^2)*q2 + E(3)*(a(3)^3)*q3 + r0 + a(3)*r1 + (a(3)^2)*r2 + (a(3)^3)*r3 == -(E(3)^2);
eqn4 = (E(4)^2)*a(4)*p1 + (E(4)^2*a(4)^2)*p2 + (E(4)^2*a(4)^3)*p3 + E(4)*q0 + E(4)*a(4)*q1 + E(4)*(a(4)^2)*q2 + E(4)*(a(4)^3)*q3 + r0 + a(4)*r1 + (a(4)^2)*r2 + (a(4)^3)*r3 == -(E(4)^2);
eqn5 = (E(5)^2)*a(5)*p1 + (E(5)^2*a(5)^2)*p2 + (E(5)^2*a(5)^3)*p3 + E(5)*q0 + E(5)*a(5)*q1 + E(5)*(a(5)^2)*q2 + E(5)*(a(5)^3)*q3 + r0 + a(5)*r1 + (a(5)^2)*r2 + (a(5)^3)*r3 == -(E(5)^2);
eqn6 = (E(6)^2)*a(6)*p1 + (E(6)^2*a(6)^2)*p2 + (E(6)^2*a(6)^3)*p3 + E(6)*q0 + E(6)*a(6)*q1 + E(6)*(a(6)^2)*q2 + E(6)*(a(6)^3)*q3 + r0 + a(6)*r1 + (a(6)^2)*r2 + (a(6)^3)*r3 == -(E(6)^2);
eqn7 = (E(7)^2)*a(7)*p1 + (E(7)^2*a(7)^2)*p2 + (E(7)^2*a(7)^3)*p3 + E(7)*q0 + E(7)*a(7)*q1 + E(7)*(a(7)^2)*q2 + E(7)*(a(7)^3)*q3 + r0 + a(7)*r1 + (a(7)^2)*r2 + (a(7)^3)*r3 == -(E(7)^2);
eqn8 = (E(8)^2)*a(8)*p1 + (E(8)^2*a(8)^2)*p2 + (E(8)^2*a(8)^3)*p3 + E(8)*q0 + E(8)*a(8)*q1 + E(8)*(a(8)^2)*q2 + E(8)*(a(8)^3)*q3 + r0 + a(8)*r1 + (a(8)^2)*r2 + (a(8)^3)*r3 == -(E(8)^2);
eqn9 = (E(9)^2)*a(9)*p1 + (E(9)^2*a(9)^2)*p2 + (E(9)^2*a(9)^3)*p3 + E(9)*q0 + E(9)*a(9)*q1 + E(9)*(a(9)^2)*q2 + E(9)*(a(9)^3)*q3 + r0 + a(9)*r1 + (a(9)^2)*r2 + (a(9)^3)*r3 == -(E(9)^2);
eqn10 = (E(10)^2)*a(10)*p1 + (E(10)^2*a(10)^2)*p2 + (E(10)^2*a(10)^3)*p3 + E(10)*q0 + E(10)*a(10)*q1 + E(10)*(a(10)^2)*q2 + E(10)*(a(10)^3)*q3 + r0 + a(10)*r1 + (a(10)^2)*r2 + (a(10)^3)*r3 == -(E(10)^2);
eqn11 = (E(11)^2)*a(11)*p1 + (E(11)^2*a(11)^2)*p2 + (E(11)^2*a(11)^3)*p3 + E(11)*q0 + E(11)*a(11)*q1 + E(11)*(a(11)^2)*q2 + E(11)*(a(11)^3)*q3 + r0 + a(11)*r1 + (a(11)^2)*r2 + (a(11)^3)*r3 == -(E(11)^2);

[M,B] = equationsToMatrix([eqn1, eqn2, eqn3, eqn4, eqn5, eqn6, eqn7, eqn8, eqn9, eqn10, eqn11], [p1, p2, p3, q0, q1, q2, q3, r0, r1, r2, r3]);

X = vpa(linsolve(M,B),8);

p1=X(1);
p2=X(2);
p3=X(3);
q0=X(4);
q1=X(5);
q2=X(6);
q3=X(7);
r0=X(8);
r1=X(9);
r2=X(10);
r3=X(11);

syms a

P = 1 + (a*p1) + (a^2*p2) + (a^3*p3);
Q = q0 + (a*q1) + (a^2*q2) + (a^3*q3);
R = r0 + (a*r1) + (a^2*r2) + (a^3*r3);

bp = (Q^2)-(4*P*R);

f = -(Q/(2*P)) + (1/(2*P))*sqrt((Q^2)-(4*P*R));

d=diff(f);
